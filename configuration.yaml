
# Loads default set of integrations. Do not remove.
default_config:

# Text to speech
tts:
  - platform: google_translate

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml


# sensor: !include sensors.yaml
modbus: !include modbus.yaml
# sensor: !include eskom.yaml
# sensor: !include EskomSePush.yaml

# hikvision: !include hikvision.yaml

sensor:
  - platform: template
    sensors:
      your_tarif:
        friendly_name: Eskom Tarrif
        unit_of_measurement: R/kWh
        value_template: >
          {% set tariff = { "HT": 2.65, "LT": 2.65 } %}
          {% if (now().weekday() < 5 and (7 <= now().hour <= 20)) or (now().weekday() == 5 and (7 <= now().hour <= 13)) %}
            {{ tariff.HT }}
          {% else %}
            {{ tariff.LT }}
          {% endif %}


template:
  #Split power in and out of battery
  - sensor:
      - name: "Battery power victron charge"
        unit_of_measurement: "W"
        unique_id: victron_battery_charged_power
        device_class: power
        state: >
          {% if states('sensor.battery_power')|float >= 0 %}
            {{ states('sensor.battery_power') }}
          {% else %}
            0
          {% endif %}
      - name: "Battery power victron discharge"
        unit_of_measurement: "W"
        unique_id: victron_battery_discharged_power
        device_class: power
        state: >
          {% if states('sensor.battery_power')|float < 0 %}
            {{ -1 * states('sensor.battery_power')|float }}
          {% else %}
            0
          {% endif %}

# - platform: integration
#     source: sensor.victron_battery_charged_power
#     unique_id: victron_battery_charged_energy
#     name: 'Victron battery in energy'
#     unit_prefix: k
#     round: 2

# - platform: integration
#   source: sensor.victron_battery_discharged_power
#   unique_id: victron_battery_discharged_energy
#   name: 'Victron battery out energy'
#   unit_prefix: k
#   round: 2      